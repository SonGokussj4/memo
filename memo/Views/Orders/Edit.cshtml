@using System.Globalization;

@model memo.ViewModels.OfferOrderVM

@{
    ViewData["Title"] = "Úprava zakázky";
    string EvektorSourceText = Model.Order.FromType == "N" ? "Evektor nabídka" : (Model.Order.FromType == "Z" ? "Evektor rámcovka" : "Bez smlouvy");

    string PriceInCzk = "";  // Show CZK field only if not Currency "CZK"
    string HiddenCzkField = "hide";  // Add classs 'hide' if not Currency "CZK"
    if (Model.Order.SharedInfo.Currency.Name != "CZK")
    {
        PriceInCzk = $"({@String.Format(CultureInfo.CreateSpecificCulture("cs-CZ"), "{0:C0}", Model.Order.SharedInfo.PriceCzk)})";
        HiddenCzkField = "";
    }
}

@await Html.PartialAsync("_Partial_ToastNotification")

<div class="text-center">
    <h1 class="display-6">@ViewData["Title"]</h1>
    <hr />
    <h3 style="color: green">@ViewBag.message</h3>
</div>

<div class="container d-flex justify-content-center">
    <div class="col-lg-10 push-lg-2 personal-info">

        <!--------------------------------------------------------------------------------------
            FORM - NABIDKA
        --------------------------------------------------------------------------------------->
        @if (@Model.Order.FromType != "-")
        {
            <div class="card">
                <div asp-validation-summary="ModelOnly" class="text-danger"></div>

                <h5 class="card-title">Detaily nabídky</h5>

                <hr />

                <div class="form-group row">
                    @if (@Model.Order.FromType == "N")
                    {
                        <label asp-for="Order.OfferId" class="col-lg-3 col-form-label form-control-label control-label">@EvektorSourceText</label>
                        <div class="col-lg-4">
                            <input asp-for="Order.Offer.OfferName" class="form-control" type="text" readonly />
                            <span asp-validation-for="Order.OfferId" class="text-danger"></span>
                        </div>
                    }
                    else if (@Model.Order.FromType == "Z")
                    {
                        <label asp-for="Order.ContractId" class="col-lg-3 col-form-label form-control-label control-label">@EvektorSourceText</label>
                        <div class="col-lg-4">
                            <input asp-for="Order.Contract.ContractName" class="form-control" type="text" readonly />
                            <span asp-validation-for="Order.ContractId" class="text-danger"></span>
                        </div>
                    }
                </div>

                <ul>
                    <li><b>Předmět:</b> @Model.Order.SharedInfo.Subject - <b>Cena:</b> @String.Format(CultureInfo.CreateSpecificCulture(Model.Order.SharedInfo.Currency.CultureCode), "{0:C0}", @Model.Order.SharedInfo.Price) @PriceInCzk</li>
                    <li><b>Zákazník:</b> @Model.Order.SharedInfo.Company.Name (<b>Splatnost faktury:</b> @Model.Order.SharedInfo.Company.InvoiceDueDays dní)</li>
                    <li>
                        <b>Přijetí poptávky:</b> @String.Format("{0:dd.MM.yyyy}", @Model.Order.SharedInfo.ReceiveDate) /
                        @if (@Model.Order.FromType == "N")
                        {
                            <b>Odeslání nabídky:</b> @String.Format("{0:dd.MM.yyyy}", @Model.Order.Offer.SentDate)
                        }
                        <b><label asp-for="Order.SharedInfo.EstimatedFinishDate"></label>:</b> @String.Format("{0:dd.MM.yyyy}", @Model.Order.SharedInfo.EstimatedFinishDate)
                    </li>
                </ul>

                <div class="cardTitleMerged">
                    <div class="">
                        <a asp-action="Index" class="btn btn-light border"><i class="fa fa-arrow-left"></i> Zpět</a>
                    </div>

                    @if (@Model.Order.FromType == "N")
                    {
                        <div class="">
                            <a asp-action="Edit" asp-controller="Offers" asp-route-id="@Model.Order.OfferId" class="btn btn-primary"><i class="fa fa-list-alt"></i> Přejít na nabídku</a>
                        </div>
                    }
                    else if (@Model.Order.FromType == "Z")
                    {
                        <div class="">
                            <a asp-action="Edit" asp-controller="Contracts" asp-route-id="@Model.Order.ContractId" class="btn btn-primary"><i class="fa fa-list-alt"></i> Přejít na rámcovku</a>
                        </div>
                    }
                </div>
            </div>

            <br />
        }

        <!--------------------------------------------------------------------------------------
            FORM - ZAKAZKA
        --------------------------------------------------------------------------------------->
        <form class="card" role="form" autocomplete="on" asp-action="Edit" method="post">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <input type="hidden" asp-for="Order.OfferId" />
        <input type="hidden" asp-for="Order.ContractId" />
        <input type="hidden" asp-for="Order.OrderId" />
        <input type="hidden" asp-for="Order.FromType" />
        <input type="hidden" asp-for="Order.SharedInfoId" />
        <input type="hidden" asp-for="Order.CreatedDate" />
        <input type="hidden" asp-for="Order.CreatedBy" />
        <input type="hidden" asp-for="Order.ModifiedBy" />
        <input type="hidden" asp-for="Order.ModifiedDate" />

        <div class="cardTitleMerged">

            <h5 class="card-title">Upravit informace o zakázce</h5>

            <div class="form-group">
                <div class="pretty p-bigger p-default p-curve p-toggle">
                    <input asp-for="Order.Active" type="checkbox"/>
                    <div class="state p-success p-on">
                        <label>Aktivní</label>
                    </div>
                    <div class="state p-danger p-off">
                        <label>Neaktivní </label>
                    </div>
                </div>
                <span asp-validation-for="Order.Active" class="text-danger"></span>
            </div>

        </div>

        <hr />

        @if (Model.Order.FromType == "-")
        {
            <input type="hidden" asp-for="Order.SharedInfo.CurrencyId" />
            <input type="hidden" asp-for="Order.SharedInfo.EstimatedFinishDate" />
            <input type="hidden" asp-for="Order.SharedInfo.ExchangeRate" />
            <input type="hidden" asp-for="Order.SharedInfo.Price" />
            <input type="hidden" asp-for="Order.SharedInfo.PriceCzk" />
            <input type="hidden" asp-for="Order.SharedInfo.SharedInfoId" />


            <div class="form-group row">
                <label asp-for="Order.SharedInfo.ReceiveDate" class="col-lg-3 col-form-label form-control-label control-label">Datum přijetí</label>
                <div class="col-lg-9 mycalendar">
                    <span class="has-float-label">
                        <input asp-for="Order.SharedInfo.ReceiveDate" class="form-control" type="text" placeholder=" " required="" autocomplete="off"/>
                        <label asp-for="Order.SharedInfo.ReceiveDate"></label>
                    </span>
                    <span asp-validation-for="Order.SharedInfo.ReceiveDate" class="text-danger"></span>
                </div>
            </div>

            <div class="form-group row">
                <label asp-for="Order.SharedInfo.Subject" class="required col-lg-3 col-form-label form-control-label control-label">Předmět</label>
                <div class="col-lg-9">
                    <span class="has-float-label">
                        <input asp-for="Order.SharedInfo.Subject" class="form-control" placeholder="Krátký popis nabídky" type="text" />
                        <label asp-for="Order.SharedInfo.Subject"></label>
                    </span>
                    <span asp-validation-for="Order.SharedInfo.Subject" class="text-danger"></span>
                </div>
            </div>

            <div class="form-group row eveOffer">
                <label class="col-lg-3 col-form-label form-control-label control-label">Evektor</label>
                <div class="col-lg-2">
                    <span class="floating-select-label">Divize</span>
                    <select class="form-control" asp-for="Order.SharedInfo.EveDivision" asp-items="@Model.EveDivisionList"></select>
                    <span asp-validation-for="Order.SharedInfo.EveDivision" class="text-danger"></span>
                </div>
                <div class="col-lg-3">
                    <span class="floating-select-label">Oddělení</span>
                    <select asp-for="Order.SharedInfo.EveDepartment" class="form-control select-department-ajax eve-department-default"></select>
                    <span asp-validation-for="Order.SharedInfo.EveDepartment" class="text-danger"></span>
                </div>
                <div class="col-lg-4">
                    <span class="floating-select-label">Uživatel</span>
                    <select asp-for="Order.SharedInfo.EveCreatedUser" class="form-control select-user-ajax eve-created-user-default"></select>
                    <span asp-validation-for="Order.SharedInfo.EveCreatedUser" class="text-danger"></span>
                </div>
            </div>

            <div class="form-group row customerOffer">
                <label class="required col-lg-3 col-form-label form-control-label control-label">Zákazník</label>
                <div class="col-lg-4">
                    <span class="floating-select-label">Firma zákazníka</span>
                    <select asp-for="Order.SharedInfo.CompanyId" class="form-control select-company-ajax company-name-default"></select>
                    <span asp-validation-for="Order.SharedInfo.CompanyId" class="text-danger"></span>
                </div>
                <div class="col-lg-1" data-toggle="tooltip" title="Nová firma">
                    <a asp-action="create" asp-controller="Companies" target="_blank">
                        <i class="form-control fa fa-plus-circle" style="color: green; cursor: pointer;"></i>
                    </a>
                </div>
                <div class="col-lg-3">
                    <span class="floating-select-label">Kontakt</span>
                    <select asp-for="Order.SharedInfo.ContactId" class="form-control select-contact-ajax contact-person-full-name-default"></select>
                    <span asp-validation-for="Order.SharedInfo.ContactId" class="text-danger"></span>
                </div>
                <div class="col-lg-1" data-toggle="tooltip" title="Nový kontakt">
                    <a asp-action="create" asp-controller="Contacts" class="modular-company-id" target="_blank">
                        <i class="form-control fa fa-plus-circle" style="color: green; cursor: pointer;"></i>
                    </a>
                </div>
            </div>

            <div class="form-group row" hidden>
                <label asp-for="Order.SharedInfo.Price" class="col-lg-3 col-form-label form-control-label control-label"></label>
                <div class="col-lg-5">
                    <span class="has-float-label">
                        <input asp-for="Order.SharedInfo.Price" class="form-control" type="text" placeholder=" "/>
                        <label asp-for="Order.SharedInfo.Price">Cena bez DPH</label>
                    </span>
                    <span asp-validation-for="Order.SharedInfo.Price" class="text-danger"></span>
                </div>
            </div>

            <hr />
        }

        <div class="form-group row">
            <label asp-for="Order.OrderName" class="required col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-9">
                <span class="has-float-label">
                    <input asp-for="Order.OrderName" class="form-control" type="text" required="" placeholder=" "/>
                    <label asp-for="Order.OrderName">Číslo objednávky zákazníka</label>
                </span>
                <span asp-validation-for="Order.OrderName" class="text-danger"></span>
            </div>
        </div>

        <div class="form-group row">
            <label asp-for="Order.EveContactName" class="required col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-3">
                <span class="floating-select-label">Vedoucí projektu</span>
                <select asp-for="Order.EveContactName" class="form-control select-user-ajax project-manager-default"></select>
                <span asp-validation-for="Order.EveContactName" class="text-danger"></span>
            </div>
            <div class="col-lg-3">
                <span class="floating-select-label">Key account manager</span>
                <select asp-for="Order.KeyAccountManager" class="form-control select-user-ajax key-account-manager-default"></select>
                <span asp-validation-for="Order.KeyAccountManager" class="text-danger"></span>
            </div>
        </div>

        <div class="form-group row">
            <label class="required col-lg-3 col-form-label form-control-label control-label">Cena dle jednacího protokolu</label>
            <div class="col-lg-3">
                <span class="has-float-label">
                    <input asp-for="Order.NegotiatedPrice" class="form-control" type="text" required placeholder=" "/>
                    <label asp-for="Order.NegotiatedPrice">Vyjednaná cena [@Model.Order.SharedInfo.Currency.Name]</label>
                </span>
                @if (Model.Order.FromType != "-")
                {
                    <span style="color: gray; font-size: 0.9em;">Sleva: @string.Format(CultureInfo.CreateSpecificCulture(@Model.Order.SharedInfo.Currency.CultureCode), "{0:C0}", @Model.Order.PriceDiscount)</span>
                }
                <span asp-validation-for="Order.NegotiatedPrice" class="text-danger"></span>
            </div>
        </div>

        @* <div class="form-group row"> *@
            @* <label asp-for="Order.PriceFinal" class="col-lg-3 col-form-label form-control-label control-label"></label> *@
            @* <div class="col-lg-3"> *@
                @* <div class="input-group mb-2 mr-sm-2"> *@
                    @* <div class="input-group-prepend"> *@
                        @* <div class="input-group-text">@Model.Order.SharedInfo.Currency.Name</div> *@
                    @* </div> *@
                    @* <input asp-for="Order.PriceFinal" class="form-control" type="text" required="" readonly/> *@
                @* </div> *@
                @* <span asp-validation-for="Order.PriceFinal" class="text-danger"></span> *@
            @* </div> *@
            @* <div class="col-lg-3"> *@
                @* <label asp-for="UnspentMoney" class="col-form-label form-control-label control-label"></label> *@
            @* </div> *@
            @* <div class="col-lg-3"> *@
                @* <div class="input-group mb-2 mr-sm-2"> *@
                    @* <div class="input-group-prepend"> *@
                        @* <div class="input-group-text">@Model.Order.SharedInfo.Currency.Name</div> *@
                    @* </div> *@
                    @* <input asp-for="UnspentMoney" class="form-control" type="text" readonly /> *@
                @* </div> *@
                @* <span asp-validation-for="UnspentMoney" class="text-danger"></span> *@
                @* <div class="progress" style="height: 5px;"> *@
                    @* @{ *@
                        @* int percentValue = Model.Order.NegotiatedPrice != 0 ? (int)Math.Ceiling(Model.UnspentMoney / (decimal)Model.Order.NegotiatedPrice * 100) : 0; *@
                        @* string progressBarWidth = percentValue >= 0 ? (100 - percentValue).ToString() : "100"; *@
                        @* string progressbarClassColor = percentValue >= 0 ? "" : "bg-danger"; *@
                    @* } *@
                    @* <div class="progress-bar @progressbarClassColor progress-bar-striped" role="progressbar" style="width: @progressBarWidth%;"></div> *@
                @* </div> *@
            @* </div> *@
        @* </div> *@

        @* Show only if not CZK *@
        <div class="form-group row @HiddenCzkField">
            <label asp-for="Order.PriceFinalCzk" class="col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-3">
                <div class="input-group mb-2 mr-sm-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text">CZK</div>
                    </div>
                    <input asp-for="Order.PriceFinalCzk" class="form-control" type="text" readonly />
                </div>
                <span asp-validation-for="Order.PriceFinalCzk" class="text-danger"></span>
            </div>
            <label asp-for="Order.ExchangeRate" class="col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-3">
                 <div class="input-group mb-2 mr-sm-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text"><span>@Model.Order.SharedInfo.Currency.Name</span></div>
                    </div>
                    <input asp-for="Order.ExchangeRate" class="form-control" type="text" />
                    <div class="input-group-append">
                        <div class="input-group-text" data-toggle="tooltip" title="Vložit dnešní kurz z ČNB" onclick="changeExchangeRate('@Model.Order.SharedInfo.Currency.Name');" style="cursor: pointer;">
                            <i class="fa fa-caret-left">&nbsp;<i class="fa fa-cloud-download"></i></i>
                        </div>
                    </div>
                </div>
                <span asp-validation-for="Order.ExchangeRate" class="text-danger"></span>
            </div>
        </div>

        <div class="form-group row justify-content-center">
            <div class="col-lg-5">
                <a href="@Url.Action("CreateEveProject")" target="_blank" class="btn btn-outline-success form-control"
                    data-toggle="tooltip" data-placement="top" title="Nová EVE zakázka">
                    <i class="fa fa-plus-square"></i> Vytvořit eve zakázku (intranet)
                </a>
            </div>
            <div class="col-lg-5">
                <a href="@Url.Action("CreateEveProject")" target="_blank" class="btn btn-outline-success form-control"
                data-toggle="tooltip" data-placement="top" title="Nová EVE modulová zakázka">
                    <i class="fa fa-plus-square"> </i> Vytvořit eve [M] zakázku (intranet)
                </a>
            </div>
        </div>

        <div class="form-group row border-top pt-2">
            <div class="col-lg-2 col-form-label d-flex justify-content-left">
                <label class="form-control-label control-label">Kód(y) vykazování</label>
            </div>
            <div class="col-lg-3">
                @* <a href="javascript:void(0)" class="btn btn-success add-row-order-codes mt-1" data-toggle="tooltip" title="Přidat hodinové sazby"> *@
                <a href="javascript:void(0)" class="btn btn-success add-partial-order-codes-href mt-1" data-toggle="tooltip" title="Přidat hodinové sazby">
                    <i class="fa fa-plus"></i> Přidat kód
                </a>
            </div>
            <div class="col-lg-6 text-right" style="color: gray; font-size: 0.9em;">
                <span>Skutečné náklady: @string.Format(CultureInfo.CreateSpecificCulture(@Model.Order.SharedInfo.Currency.CultureCode), "{0:C0}", @Model.Order.RealExpensesSum)</span>
                <i class="fa fa-question" data-toggle="tooltip" title="@Model.Order.RealExpensesSumTooltip"></i>
                <br>
                <span>Celkové skut. náklady: @string.Format(CultureInfo.CreateSpecificCulture(@Model.Order.SharedInfo.Currency.CultureCode), "{0:C0}", @Model.Order.RealExpensesAndOtherCostsSum)</span>
                <i class="fa fa-question" data-toggle="tooltip" title="@Model.Order.RealExpensesAndOtherCostsSumTooltip"></i>
                <br>
                <span>Odčerpáno nákladů: @string.Format(CultureInfo.CreateSpecificCulture(@Model.Order.SharedInfo.Currency.CultureCode), "{0:C0}", @Model.Order.RealExpensesUsedUpSum)</span>
                <i class="fa fa-question" data-toggle="tooltip" title="@Model.Order.RealExpensesUsedUpSumTooltip"></i>
            </div>
        </div>

        @* @Html.ValidationMessage("OrderCodesValidationMessage", "", new { @class = "text-danger" }) *@
        <div class="dynamic-rows-order-codes" id="template-order-codes" data-order="@Model.Order.OrderCodes.Count()">

            <!-- PLACEHOLDER: _Partial_Modal_SearchOrderCode -->
            <div id="modal-placeholder"></div>

            @for (int i = 0; i < Model.Order.OrderCodes.Count(); i++)
            {
                @await Html.PartialAsync("Partials/Orders/_Partial_OrderCodes", Model, new ViewDataDictionary(ViewData) {{ "i", i }})
            }
            @* <span asp-validation-for="Order.OrderCodes" class="text-danger"></span> *@

            <!-- PLACEHOLDER: _Partial_OrderCodes_Create -->
            @* <div class="add-partial-order-codes"></div> *@
        </div>

        <div class="form-group row border-top pt-2">
            <div class="col-lg-2 col-form-label d-flex justify-content-left">
                <label class="form-control-label control-label">Faktury</label>
            </div>
            <div class="col-lg-3">
                <a href="javascript:void(0)" class="btn btn-success add-row-invoices mt-1" data-toggle="tooltip" title="Přidat fakturaci">
                    <i class="fa fa-plus"></i> Přidat fakturaci
                </a>
            </div>
            <div class="col-lg-6 text-right" style="color: gray; font-size: 0.9em;">
                <span>Celkem: @string.Format(CultureInfo.CreateSpecificCulture(@Model.Order.SharedInfo.Currency.CultureCode), "{0:C0}", @Model.Order.GetSumInvoices())</span>
                <i class="fa fa-question" data-toggle="tooltip" title="Suma jednotlivých vyfakturovaných částek"></i>
                <br>
                <span>Zbývá: @string.Format(CultureInfo.CreateSpecificCulture(@Model.Order.SharedInfo.Currency.CultureCode), "{0:C0}", @Model.Order.NegotiatedPrice - @Model.Order.GetSumInvoices())</span>
                <i class="fa fa-question" data-toggle="tooltip" title="Vyjednaná cena - Suma faktur"></i>
            </div>
        </div>



        @Html.ValidationMessage("InvoiceMissing", "", new { @class = "text-danger" })
        <div class="dynamic-rows-invoices" id="template-invoices" data-order="@Model.Order.Invoices.Count()">
            @for (int i = 0; i < Model.Order.Invoices.Count(); i++)
            {
                <div class="dynamicrowsgroup mb-4 pt-4" style="border-top: 1px solid #0000000d;">

                    <div class="row form-group justify-content-end">

                        <input hidden="true" asp-for="@Model.Order.Invoices[i].InvoiceId" />

                        <div class="col-lg-3 mycalendar">
                            <span class="has-float-label">
                                <input asp-for="@Model.Order.Invoices[i].InvoiceIssueDate" class="form-control" type="text" autocomplete="off" data-id="@i" placeholder=" " />
                                <label asp-for="@Model.Order.Invoices[i].InvoiceIssueDate">Termín vystavení</label>
                            </span>
                            <span asp-validation-for="@Model.Order.Invoices[i].InvoiceIssueDate" class="text-danger"></span>
                        </div>

                        <div class="col-lg-3 mycalendar">
                            <span class="has-float-label">
                                <input asp-for="@Model.Order.Invoices[i].InvoiceDueDate" class="form-control" type="text" autocomplete="off" data-id="@i" placeholder=" " />
                                <label asp-for="@Model.Order.Invoices[i].InvoiceDueDate">Splatnost faktury</label>
                            </span>
                            <span asp-validation-for="@Model.Order.Invoices[i].InvoiceDueDate" class="text-danger"></span>
                        </div>

                        <div class="col-lg-3">
                            <span class="has-float-label">
                                <input asp-for="@Model.Order.Invoices[i].Cost" class="form-control" type="text" placeholder=" " />
                                <label asp-for="@Model.Order.Invoices[i].Cost">Částka [@Model.Order.SharedInfo.Currency.Name]</label>
                            </span>
                            <span asp-validation-for="@Model.Order.Invoices[i].Cost" class="text-danger"></span>
                        </div>

                        <div class="col-lg-1">
                            <a href="javascript:void(0)" class="btn btn-danger btn-sm mt-1" data-toggle="tooltip" title="Odstranit záznam" onclick="DeleteInvoice(@Model.Order.Invoices[i].InvoiceId)"><i class="fa fa-trash"></i></a>
                        </div>

                    </div>

                    <div class="row form-group justify-content-end">
                        <div class="col-lg-9">
                            <span class="has-float-label">
                                <input asp-for="@Model.Order.Invoices[i].DeliveryNote" class="form-control" type="text" placeholder="Cesta k dodacímu listu"/>
                                <label asp-for="@Model.Order.Invoices[i].DeliveryNote">Dodací list</label>
                            </span>
                            <span asp-validation-for="@Model.Order.Invoices[i].DeliveryNote" class="text-danger"></span>
                        </div>
                        <div class="col-lg-1"></div>
                    </div>

                </div>
            }
            <span asp-validation-for="Order.Invoices" class="text-danger"></span>
        </div>

        <div class="form-group row border-top pt-2">
            <div class="col-lg-2 col-form-label d-flex justify-content-left">
                <label class="form-control-label control-label">Další náklady</label>
            </div>
            <div class="col-lg-10">
                <a href="javascript:void(0)" class="btn btn-success col-lg-3 add-row-other-costs mt-1" data-toggle="tooltip" title="Přidat další náklady"><i class="fa fa-plus"></i> Další náklady</a>
            </div>
        </div>

        @Html.ValidationMessage("OtherCostsValidationMessage", "", new { @class = "text-danger" })
        <div class="dynamic-rows-other-costs" id="template-other-costs" data-order="@Model.Order.OtherCosts.Count()">
            @for (int i = 0; i < Model.Order.OtherCosts.Count(); i++)
            {
                <div class="row form-group justify-content-end">
                    <input hidden="true" asp-for="@Model.Order.OtherCosts[i].OtherCostId" />
                    <div class="col-lg-6">
                        <span class="has-float-label">
                            <input asp-for="@Model.Order.OtherCosts[i].Subject" class="form-control" type="text" autocomplete="off" placeholder=" "/>
                            <label asp-for="@Model.Order.OtherCosts[i].Subject">Stručný popis</label>
                        </span>
                        <span asp-validation-for="@Model.Order.OtherCosts[i].Subject" class="text-danger"></span>
                    </div>

                    <div class="col-lg-3">
                        <span class="has-float-label">
                            <input asp-for="@Model.Order.OtherCosts[i].Cost" class="form-control" type="text" placeholder=" "/>
                            <label asp-for="@Model.Order.OtherCosts[i].Cost">Částka [@Model.Order.SharedInfo.Currency.Name]</label>
                        </span>
                        <span asp-validation-for="@Model.Order.OtherCosts[i].Cost" class="text-danger"></span>
                    </div>

                    <div class="col-lg-1">
                        <a href="javascript:void(0)" class="btn btn-danger btn-sm mt-1" data-toggle="tooltip" title="Odstranit záznam" onclick="DeleteOtherCost(@Model.Order.OtherCosts[i].OtherCostId)"><i class="fa fa-trash"></i></a>
                    </div>
                </div>
            }
            <span asp-validation-for="Order.OtherCosts" class="text-danger"></span>
        </div>

        <div class="form-group row">
            <label asp-for="Order.Notes" class="col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-9">
                <textarea asp-for="Order.Notes" class="form-control"></textarea>
                <span asp-validation-for="Order.Notes" class="text-danger"></span>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-lg-12">
                <div class="d-flex justify-content-between">
                    <label asp-for="Order.CreatedDate" ></label>
                    <b>@Model.Order.CreatedDate</b>
                    <label asp-for="Order.ModifiedDate"></label>
                    <b>@Model.Order.ModifiedDate</b>
                </div>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-lg-3">
                <a asp-action="Index" class="btn btn-light border"><i class="fa fa-arrow-left"></i> Zpět</a>
            </div>
            <div class="col-lg-9">
                <input type="submit" class="btn btn-primary" name="actionType" value="Uložit" />
                <input type="submit" class="btn btn-primary" name="actionType" value="Uložit a zavřít" />
                <a href="#" class="btn btn-danger pull-right" onclick="ConfirmDelete(@Model.Order.OrderId)">Smazat</a>
            </div>
        </div>

        </form>
    </div>
</div>


<div class="d-flex justify-content-center pt-3">
    <a href="#collapsible-audits" class="btn-sm btn-primary collapsed" data-toggle="collapse">
        <i class="if-collapsed fa fa-fw fa-chevron-down"></i>
        <i class="if-not-collapsed fa fa-fw fa-chevron-up"></i>
        Poslední změny <span class="badge badge-pill badge-light">@Model.Audits.Count()</span>
    </a>
</div>

<div class="collapse" id="collapsible-audits">
    @await Html.PartialAsync("_Partial_AuditChanges", Model)
</div>


<!-----------------------------------------------  M O D A L S  ----------------------------------------------->

<!-------------------------->
<!-- Modal Confirm Delete -->
<!-------------------------->
<div class="modal fade" id="deleteConfirmModal" tabindex="-1" role="dialog" aria-labelledby="deleteConfirmModalLabel">
    <div class="modal-dialog modal-md" role="document">
        <div class="modal-content">
            <!-- header -->
            <div class="modal-header">
                <h5 class="modal-title" id="deleteConfirmModalLabel">Smazání nabídky</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            </div>
            <!-- body -->
            <div class="modal-body">
                Opravdu smazat?<br />
                Ev. Číslo: <b>@Model.Order.OrderName</b>
            </div>
            <!-- footer -->
            <div class="modal-footer">
                <a href="#" class="btn btn-info" data-dismiss="modal">Zpět</a>
                <a href="#" class="btn btn-warning" onclick="DeactivateItem()">Deaktivovat</a>
                <a href="#" class="btn btn-danger" onclick="DeleteItem()">Smazat</a>
            </div>
        </div>
    </div>
</div>


@section Scripts {

    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}
    <script src="~/js/CustomValidation.js"></script>

    <script>

        function AddInvoiceDueDays(inputId) {
            var _invoiceIssueInput = $('#Order_Invoices_' + inputId + '__InvoiceIssueDate');
            var date = new Date(_invoiceIssueInput.val());
            var futureDate = getPrettyDate(date, @Model.Order.SharedInfo.Company.InvoiceDueDays);
            var _invoiceDueInput = $('#Order_Invoices_' + inputId + '__InvoiceDueDate').val(futureDate);
        }

        function DeleteInvoice(invoiceId) {
            var rowDeliveryNote = document.getElementById(`dynamic-row-delivery-note-${invoiceId}`);
            if (rowDeliveryNote != null) {
                rowDeliveryNote.remove();
            }
            var row = document.getElementById(`dynamic-row-invoice-${invoiceId}`);
            if (row != null) {
                row.remove();
            }
            else {
                $.ajax({
                    //async: true,
                    type: 'POST',
                    dataType: 'JSON',
                    ContentType: 'application/json; charset=utf-8',
                    url: '@Url.Action("DeleteInvoice")',
                    data: { id: invoiceId },
                    cache: false,
                    beforeSend:function(){
                        return confirm(
                            "Jste si jisti??? Tento úkon smaže již uloženou fakturaci!"
                        );
                    },
                    success: function(data) {
                        window.location = "@Model.Order.OrderId";  // return Orders/Edit/{OrderId}
                    },
                    @* error: function(data) {
                        //alert(JSON.stringify(data.responseJSON.errorMessage));
                        alert(data.responseJSON.errorMessage);
                    } *@
                });
            }
        }

        function DeleteOtherCost(otherCostId) {
            console.log(`Deleting invoice id: ${otherCostId}`);
            var row = document.getElementById(`dynamic-row-other-costs-${otherCostId}`);
            if (row != null) {
                row.remove();
            }
            else {
                $.ajax({
                    //async: true,
                    type: 'POST',
                    dataType: 'JSON',
                    ContentType: 'application/json; charset=utf-8',
                    url: '@Url.Action("DeleteOtherCost")',
                    data: { id: otherCostId },
                    cache: false,
                    beforeSend:function(){
                        return confirm(
                            "Jste si jisti??? Tento úkon smaže označený další náklad!"
                        );
                    },
                    success: function(data) {
                        window.location = "@Model.Order.OrderId";  // return Orders/Edit/{OrderId}
                    },
                    @* error: function(data) {
                        //alert(JSON.stringify(data.responseJSON.errorMessage));
                        alert(data.responseJSON.errorMessage);
                    } *@
                });
            }
        }

        function DeleteOrderCode(orderCodeId) {
            //var row = document.getElementById(`dynamic-row-order-codes-${orderCodeId}`);
            const row = $(`#dynamic-row-order-codes-${orderCodeId}`);
            if (row.length != 0) {
                const btnTrash = row.find("a.btn.btn-danger").tooltip("hide");
                row.remove();
            }
            else {
                $.ajax({
                    async: true,
                    type: 'POST',
                    dataType: 'JSON',
                    ContentType: 'application/json; charset=utf-8',
                    url: '@Url.Action("DeleteOrderCode")',
                    data: { id: orderCodeId },
                    cache: false,
                    beforeSend:function(){
                        return confirm(
                            "Jste si jisti??? Tento úkon smaže označený kód vykazování!"
                        );
                    },
                    success: function(data) {
                        window.location = "@Model.Order.OrderId";  // return Orders/Edit/{OrderId}
                    },
                    @* error: function(data) {
                        alert(data.responseJSON.errorMessage);
                    } *@
                });
            }
        }

//        function changeExchangeRate(curSymbol) {
//            $.ajax({
//                url: '@Url.Action("getCurrencyStr", "Orders")',
//                type: 'GET',
//                //dataType: 'json',
//                // we set cache: false because GET requests are often cached by browsers
//                // IE is particularly aggressive in that respect
//                cache: false,
//                data: { symbol: curSymbol },
//                success: function(res) {
//                    //$('#Order_ExchangeRate').val(res).focus().keyup().blur();
//                    $('#Order_ExchangeRate').val(res).keyup();
//                }
//            });
//        }


        // MODAL dialog for delete confirmation
        //-------------------------------------
        var ConfirmDelete = function (ItemId) {
            $("#deleteConfirmModal").modal('show');
        };

        // POST delete command to controller
        //----------------------------------
        function DeleteItem() {
            $.ajax({
                type: "POST",
                url: '@Url.Action("Delete")',
                data: { Id: @Model.Order.OrderId },
                beforeSend: function (request) {
                    request.setRequestHeader("RequestVerificationToken", $("[name='__RequestVerificationToken']").val());
                },
                success: function () {
                    $("#deleteConfirmModal").modal("hide")
                    window.location.href = '../'
                },
                error: function() {
                    alert("Nelze z nějakého důvodu odstranit...");
                    $("#deleteConfirmModal").modal("hide");
                }
            })
        }

        // POST deactivate command to controller
        //----------------------------------
        function DeactivateItem() {
            $.ajax({
                type: "POST",
                url: '@Url.Action("Deactivate")',
                data: { Id: @Model.Order.OrderId },
                success: function () {
                    $("#deleteConfirmModal").modal("hide")
                    window.location.href = './' + @Model.Order.OrderId
                },
                error: function() {
                    alert("Nelze z nějakého důvodu deaktivovat...");
                    $("#deleteConfirmModal").modal("hide");
                }
            })
        }

        function changeExchangeRate(curSymbol) {
            $.ajax({
                url: '@Url.Action("getCurrencyStr", "Orders")',
                type: 'GET',
                //dataType: 'json',
                // we set cache: false because GET requests are often cached by browsers
                // IE is particularly aggressive in that respect
                cache: false,
                data: { symbol: curSymbol },
                success: function(res) {
                    //$('#Order_ExchangeRate').val(res).focus().keyup().blur();
                    $('#Order_ExchangeRate').val(res).keyup();
                }
            });
        }

        // -----------------------  DOCUMENT READY  --------------------------//
        $(document).ready(function(){

            // DEFAULT VALUES
            // =======================================
            $('.project-manager-default').append(new Option('@Html.Raw(Model.Order.EveContactName)', '@Html.Raw(Model.Order.EveContactName)', false, false)).trigger('change');
            $('.key-account-manager-default').append(new Option('@Html.Raw(Model.Order.KeyAccountManager)', '@Html.Raw(Model.Order.KeyAccountManager)', false, false)).trigger('change');

            if ('@Html.Raw(Model.Order.FromType)' == '-')
            {
                // Add attribute when changing Selectlist value
                var originalHref = $('.modular-company-id').attr('href');
                $('#Order_SharedInfo_CompanyId').change(function () {
                    $('.modular-company-id').attr('href', originalHref + "?companyId=" + $(this).children('option:selected').val());
                })

                // DEFAULT VALUES
                // =======================================
                $('.eve-department-default').append(new Option('@Html.Raw(Model.Order.SharedInfo.EveDepartment)', '@Html.Raw(Model.Order.SharedInfo.EveDepartment)', false, false)).trigger('change');
                $('.eve-created-user-default').append(new Option('@Html.Raw(Model.Order.SharedInfo.EveCreatedUser)', '@Html.Raw(Model.Order.SharedInfo.EveCreatedUser)', false, false)).trigger('change');
                $('.company-name-default').append(new Option('@Html.Raw(Model.Order.SharedInfo.Company.Name)', '@Html.Raw(Model.Order.SharedInfo.CompanyId)', false, false)).trigger('change');
                $('.contact-person-full-name-default').append(new Option('@Html.Raw(Model.Order.SharedInfo.Contact.PersonFullName)', '@Html.Raw(Model.Order.SharedInfo.ContactId)', false, false)).trigger('change');

                // OTHER
                // =======================================
                // Clear and unselect '.select-contact-ajax' when '.select-company-ajax' changes it's value
                $('.select-company-ajax').on('select2:select', function (e) {
                    $(".select-contact-ajax").val(null).empty().trigger('change');
                });
            };

            // OTHER
            // =======================================
            let orderName = '@Html.Raw(@Model.Order.OrderName)';

            checkItemNameExists($("#Order_OrderName"), 'Orders', ignoreName=orderName);

            $('.mycalendar input').datepicker(datepickerParameters[0]);

            var offerPrice = parseInt('@Model.Order.SharedInfo.Price');

            $('#Order_NegotiatedPrice').on('keydown input change textInput', function(){
                var negotiatedPrice = parseInt($('#Order_NegotiatedPrice').val());
                $('#Order_PriceDiscount').val(offerPrice - negotiatedPrice);
            });

            $('#Order_PriceDiscount').on('keydown input change textInput', function(){
                var priceDiscount = parseInt($('#Order_PriceDiscount').val());
                $('#Order_NegotiatedPrice').val(offerPrice - priceDiscount);
            });

            $('#Order_InvoiceIssueDate').change('input', function(){
                var date = new Date($('#Order_InvoiceIssueDate').val());
                var futureDate = getPrettyDate(date, @Model.Order.SharedInfo.Company.InvoiceDueDays);
                $('#Order_InvoiceDueDate').val(futureDate);
            });

            // Active on(changeDate) events for existing InvoiceIssueDate datepicker inputs
            let childrenIssueDate = document.querySelectorAll('[id$="InvoiceIssueDate"]');
            childrenIssueDate.forEach( function(item) {
                let dateInput = $(`#${item.id}`);
                dateInput.on("changeDate", function(data) {
                    var date = data.date;
                    var futureDate = getPrettyDate(date, @Model.Order.SharedInfo.Company.InvoiceDueDays);
                    var childIssueId = data.target.id.split("__")[0];  // Order_Invoices_X
                    childDue = $(`#${childIssueId}__InvoiceDueDate`).val(futureDate);
                });
            });

            // Add new ORDER CODES row
            var idNewOrderCode = @Model.Order.OrderCodes.Count();
            $('.add-partial-order-codes-href').on('click', function() {
                $.ajax({
                    url: '@Url.Action("AddOrderCodesPartial", "Orders")/' + idNewOrderCode,
                    dataType: 'html',
                    success: function (result) {
                        //$(".add-partial-order-codes").append(result);
                        $(".dynamic-rows-order-codes").append(result);
                        initializeTooltips();
                        initializeOrderAjaxModalClickEvent();
                        $('form').data('validator', null);
                        $.validator.unobtrusive.parse($('form'));
                    }
                });
                idNewOrderCode = idNewOrderCode + 1;
            });

//            // Add new ORDER CODES row
//            var idOrderCode = @Model.Order.OrderCodes.Count();
//            $('.add-row-order-codes').click(function () {
//                var urlAction = '@Url.Action("GetOrderCodes", "Orders")/' + idOrderCode;
//                var html =
//                    '<div class="row form-group justify-content-end" id="dynamic-row-order-codes-' + idOrderCode + '">'+
//
//                        '<!-- Modal placeholder -->'+
//
//                        '<input hidden="true" type="number" data-val="true" data-val-required="The OrderCodeId field is required." id="Order_OrderCodes_' + idOrderCode + '__OrderCodeId" name="Order.OrderCodes[' + idOrderCode + '].OrderCodeId" value="0">'+
//
//                        '<div class="col-lg-3">'+
//                            '<span class="has-float-label">'+
//                                '<div class="input-group">'+
//                                    '<input class="form-control" type="text" autocomplete="off" placeholder=" " data-val="true" data-val-length="The field Kód vykazování EVE must be a string with a maximum length of 50." data-val-length-max="50" data-val-regex="Kód ve formátu xxx.xxxx" data-val-regex-pattern="(\\d{3}[.]\\d{4})?" id="Order_OrderCodes_' + idOrderCode + '__OrderCode" maxlength="50" name="Order.OrderCodes[' + idOrderCode + '].OrderCode" value="">'+
//                                    '<div class="input-group-append">'+
//                                        '<!-- Button trigger modal -->'+
//                                        '<span data-toggle="tooltip" title="" data-original-title="Vyhledat kód">'+
//                                            '<button class="btn btn-light border" type="button" data-toggle="ajax-modal" data-target="#SearchForOrderCodeModal" data-url="' + urlAction + '">'+
//                                                '<i class="fa fa-search"></i>'+
//                                            '</button>'+
//                                        '</span>'+
//                                    '</div>'+
//                                '</div>'+
//                                '<label for="Order_OrderCodes_' + idOrderCode + '__OrderCode">Kód vykazování</label>'+
//                            '</span>'+
//                            '<span class="text-danger field-validation-valid" data-valmsg-for="Order.OrderCodes[' + idOrderCode + '].OrderCode" data-valmsg-replace="true"></span>'+
//                        '</div>'+
//
//                        '<div class="col-lg-3">'+
//                            '<span class="has-float-label">'+
//                                '<input class="form-control" type="text" autocomplete="off" placeholder=" " data-val="true" data-val-length="The field Hodinová mzda @Model.Order.SharedInfo.Currency.Name must be a string with a maximum length of 50." data-val-length-max="50" id="Order_OrderCodes_' + idOrderCode + '__HourWageSubject" maxlength="50" name="Order.OrderCodes[' + idOrderCode + '].HourWageSubject" value="">'+
//                                '<label for="Order_OrderCodes_' + idOrderCode + '__HourWageSubject">Popis hod. mzdy</label>'+
//                            '</span>'+
//                            '<span class="text-danger field-validation-valid" data-valmsg-for="Order.OrderCodes[' + idOrderCode + '].HourWageSubject" data-valmsg-replace="true"></span>'+
//                        '</div>'+
//
//                        '<div class="col-lg-3">'+
//                            '<span class="has-float-label">'+
//                                '<input class="form-control" type="text" placeholder=" " data-val="true" data-val-number="The field Hodinová mzda must be a number." id="Order_OrderCodes_' + idOrderCode + '__HourWageCost" name="Order.OrderCodes[' + idOrderCode + '].HourWageCost" value="">'+
//                                '<label for="Order_OrderCodes_' + idOrderCode + '__HourWageCost">Hod. mzda [@Model.Order.SharedInfo.Currency.Name]</label>'+
//                            '</span>'+
//                            '<span class="text-danger field-validation-valid" data-valmsg-for="Order.OrderCodes[' + idOrderCode + '].HourWageCost" data-valmsg-replace="true"></span>'+
//                        '</div>'+
//
//                        '<div class="col-lg-1">'+
//                            '<a href="javascript:void(0)" class="btn btn-danger btn-sm mt-1" data-toggle="tooltip" title="" onclick="DeleteOrderCode(' + idOrderCode + ')" data-original-title="Odstranit záznam"><i class="fa fa-trash"></i></a>'+
//                        '</div>'+
//
//                    '</div>';
//
//                //$("tbody").append($(html).clone(true))
//                var _formTemp = $("#template-order-codes").clone(true)
//                var _targetForm = $(".dynamic-rows-order-codes")
//                _targetForm.append(html)
//
//                floatingLabelsInit();
//                initializeTooltips();
//                initializeOrderAjaxModalClickEvent();
//
//                $('form').data('validator', null);
//                $.validator.unobtrusive.parse($('form'));
//
//                idOrderCode = idOrderCode + 1;
//                return false;
//            });

            // Add new INVOICES row
            var idInvoice = @Model.Order.Invoices.Count();
            $('.add-row-invoices').click(function () {
                var html =''+
                    @* '<div class="dynamic-rows-invoices" id="template-invoices" data-order="' + idInvoice + '">'+ *@
                        '<div class="row form-group border-top pt-4 justify-content-end" id="dynamic-row-invoice-' + idInvoice + '">'+

                            '<input type="number" hidden="true" data-val="true" data-val-required="The InvoiceId field is required." id="Order_Invoices_' + idInvoice + '__InvoiceId" name="Order.Invoices[' + idInvoice + '].InvoiceId" value="0">'+

                            '<div class="col-lg-3 mycalendar">'+
                                '<span class="has-float-label">'+
                                    '<input class="form-control" type="text" autocomplete="off" placeholder="rrrr-mm-dd" data-id="' + idInvoice + '" data-val="true" data-val-required="The Předp. termín vystavení faktury field is required." id="Order_Invoices_' + idInvoice + '__InvoiceIssueDate" name="Order.Invoices[' + idInvoice + '].InvoiceIssueDate" value="">'+
                                    '<label for="Order_Invoices_' + idInvoice + '__InvoiceIssueDate">Termín vystavení</label>'+
                                '</span>'+
                                '<span class="text-danger field-validation-valid" data-valmsg-for="Order.Invoices[' + idInvoice + '].InvoiceIssueDate" data-valmsg-replace="true"></span>'+
                            '</div>'+

                            '<div class="col-lg-3">'+
                                '<span class="has-float-label">'+
                                    '<input class="form-control" type="text" autocomplete="off" placeholder="rrrr-mm-dd" data-val="true" data-id="' + idInvoice + '" data-val-required="The Splatnost faktury field is required." id="Order_Invoices_' + idInvoice + '__InvoiceDueDate" name="Order.Invoices[' + idInvoice + '].InvoiceDueDate" value="">'+
                                    '<label for="Order_Invoices_' + idInvoice + '__InvoiceDueDate">Splatnost faktury</label>'+
                                '</span>'+
                                '<span class="text-danger field-validation-valid" data-valmsg-for="Order.Invoices[' + idInvoice + '].InvoiceDueDate" data-valmsg-replace="true"></span>'+
                            '</div>'+

                            '<div class="col-lg-3">'+
                                '<span class="has-float-label">'+
                                    '<input class="form-control" type="text" placeholder="Částka" data-val="true" data-val-number="The field Částka must be a number." data-val-required="The Částka field is required." id="Order_Invoices_' + idInvoice + '__Cost" name="Order.Invoices[' + idInvoice + '].Cost" value="" />'+
                                    '<label for="Order_Invoices_' + idInvoice + '__Cost">Částka [@Model.Order.SharedInfo.Currency.Name]</label>'+
                                '</span>'+
                                '<span class="text-danger field-validation-valid" data-valmsg-for="Order.Invoices[' + idInvoice + '].Cost" data-valmsg-replace="true"></span>'+
                            '</div>'+

                            '<div class="col-lg-1">'+
                                '<a href="javascript:void(0)" class="btn btn-danger btn-sm mt-1" data-toggle="tooltip" title="" data-original-title="Odstranit záznam" onclick="DeleteInvoice(' + idInvoice + ')"><i class="fa fa-trash white"></i></a>'+
                            '</div>'+

                        '</div>'+

                        '<div class="row form-group justify-content-end " id="dynamic-row-delivery-note-' + idInvoice + '">'+
                            '<div class="col-lg-9">'+
                                '<span class="has-float-label">'+
                                    '<input class="form-control" type="text" placeholder="Cesta k dodacímu listu" id="Order_Invoices_' + idInvoice + '__DeliveryNote" name="Order.Invoices[' + idInvoice + '].DeliveryNote" value="" />'+
                                    '<label for="Order_Invoices_' + idInvoice + '__DeliveryNote">Dodací list</label>'+
                                '</span>'+
                                '<span data-valmsg-for="Order.Invoices[' + idInvoice + '].DeliveryNote" data-valmsg-replace="true" class="text-danger"></span>'+
                            '</div>'+
                            '<div class="col-lg-1"></div>'+
                        '</div>'
                    @* '</div>' *@
                    ;
                var _formTemp = $("#template-invoices").clone(true)
                var _targetForm = $(".dynamic-rows-invoices")
                _targetForm.append(html)

                var _invoiceIssueInput = $('#Order_Invoices_' + idInvoice + '__InvoiceIssueDate');
                var _invoiceDueInput = $('#Order_Invoices_' + idInvoice + '__InvoiceDueDate');

                var parsed_date = @Html.Raw(Json.Serialize(Model.Order.SharedInfo.EstimatedFinishDate))
                if ( parsed_date != null) {
                    var issueDate = getPrettyDate(new Date(parsed_date), 0)
                    //_invoiceIssueInput.val(new Date(parsed_date).toISOString().substring(0, 10));
                    _invoiceIssueInput.val(issueDate);
                    var date = new Date(_invoiceIssueInput.val());
                    var futureDate = getPrettyDate(date, @Model.Order.SharedInfo.Company.InvoiceDueDays);
                    _invoiceDueInput.val(futureDate);
                }

                _invoiceIssueInput.datepicker(datepickerParameters[0]);
                _invoiceDueInput.datepicker(datepickerParameters[0]);
                $('.newlyAddedTooltip').tooltip();

                _invoiceIssueInput.on("changeDate", function(data) {
                    var date = data.date;
                    var futureDate = getPrettyDate(date, @Model.Order.SharedInfo.Company.InvoiceDueDays);
                    $('#Order_Invoices_' + _invoiceIssueInput.data('id') + '__InvoiceDueDate').val(futureDate);
                });

                floatingLabelsInit();

                $('form').data('validator', null);
                $.validator.unobtrusive.parse($('form'));

                idInvoice = idInvoice + 1;
                return false;
            });


            // Add new OTHER COSTS row
            var idOtherCosts = @Model.Order.OtherCosts.Count();
            $('.add-row-other-costs').click(function () {
                var html =
                    '<div class="row form-group justify-content-end" id="dynamic-row-other-costs-' + idOtherCosts + '">'+

                        '<input type="number" hidden="true" data-val="true" data-val-required="The OtherCostId field is required." id="Order_OtherCosts_' + idOtherCosts + '__OtherCostId" name="Order.OtherCosts[' + idOtherCosts + '].OtherCostId" value="0">'+

                        '<div class="col-lg-6">'+
                            '<input class="form-control" type="text" autocomplete="off" placeholder="Popis" data-val="true" data-val-required="Je třeba přidat popis dalšího nákladu" id="Order_OtherCosts_' + idOtherCosts + '__Subject" name="Order.OtherCosts[' + idOtherCosts + '].Subject" value="">'+
                            '<span class="text-danger field-validation-valid" data-valmsg-for="Order.OtherCosts[' + idOtherCosts + '].Subject" data-valmsg-replace="true"></span>'+
                        '</div>'+

                        '<div class="col-lg-3">'+
                            '<span class="has-float-label">'+
                                '<input class="form-control" type="text" placeholder="Částka" data-val="true" data-val-number="The field Částka must be a number." data-val-required="The Částka field is required." id="Order_OtherCosts_' + idOtherCosts + '__Cost" name="Order.OtherCosts[' + idOtherCosts + '].Cost" value="" />'+
                                '<label for="Order_OtherCosts_' + idOtherCosts + '__Cost"">Částka [@Model.Order.SharedInfo.Currency.Name]</label>'+
                            '</span>'+
                            '<span class="text-danger field-validation-valid" data-valmsg-for="Order.OtherCosts[' + idOtherCosts + '].Cost" data-valmsg-replace="true"></span>'+
                        '</div>'+

                        '<div class="col-lg-1">'+
                            '<a href="javascript:void(0)" class="btn btn-danger btn-sm mt-1" data-toggle="tooltip" title="" data-original-title="Odstranit záznam" onclick="DeleteOtherCost(' + idOtherCosts + ')"><i class="fa fa-trash white"></i></a>'+
                        '</div>'+
                    '</div>';

                //$("tbody").append($(html).clone(true))
                var _formTemp = $("#template-other-costs").clone(true)
                var _targetForm = $(".dynamic-rows-other-costs")
                _targetForm.append(html)

                $('form').data('validator', null);
                $.validator.unobtrusive.parse($('form'));

                idOtherCosts = idOtherCosts + 1;
                return false;
            });


        })



    </script>

}

