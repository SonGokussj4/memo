@using System.Globalization

@{
    ViewData["Title"] = "Nová zakázka";
}

@* @model memo.ViewModels.CreateOfferViewModel *@
@model memo.ViewModels.OfferOrderVM

<style>
    @* .money-label::after {
        content: " [@Model.CurrencyName]";
        color: black;
        font-size: 1em;
    } *@
    .input-group-text {
        font-size: 0.9rem;
    }
    .input-validation-error {
        border-color: red;
    }
    .cardTitleMerged {
        display: flex;
        justify-content: space-between;
    }
    .input-group-text {
        font-size: 0.9rem;
    }
</style>

<div class="text-center">
    <h1 class="display-6">@ViewData["Title"]</h1>
    <hr />
</div>

<div class="container d-flex justify-content-center">
    <div class="col-lg-8 push-lg-4 personal-info">

        @* @Html.HiddenFor(model => model.ReturnUrl) *@

        <!--------------------------------------------------------------------------------------
            FORM - OBJEDNAVKA
        --------------------------------------------------------------------------------------->
        <form class="card" role="form" autocomplete="on" asp-action="Refresh" method="post">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>

        <h5 class="card-title">Detaily objednávky</h5>
        <hr />

        <div class="form-group row">
            <label asp-for="Order.OfferId" class="required col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-4">
                @* <input type="hidden" asp-for="Order.OfferId" /> *@
                <input type="hidden" asp-for="Order.OrderId" />
                @* <input asp-for="Order.OrderId" /> *@
                @* @Html.DropDownListFor(model => model.Order.OfferId, ViewBag.WonOffersList as SelectList, "-- Vyber Objednávku --", new { @class = "form-control", onchange = @"this.form.submit();" }) *@
                @Html.DropDownList("OfferId", ViewBag.WonOffersList as SelectList, "-- Vyber objednávku --", new { @class = "form-control selectpicker", onchange = @"this.form.submit();" })
                @* <input asp-for="Offer.OfferName" class="form-control" type="text" readonly /> *@
                <span asp-validation-for="Order.OfferId" class="text-danger"></span>
            </div>
            @* <div class="col-lg-1">
                <label asp-for="OfferCompanyName" class="col-form-label form-control-label control-label"></label>
            </div>
            <div class="col-lg-4">
                <input asp-for="OfferCompanyName" class="form-control" type="text" readonly />
                <span asp-validation-for="OfferCompanyName" class="text-danger"></span>
            </div> *@
        </div>

        @if (@Model.Offer?.OfferId != 0 && @Model.Offer?.OfferId != null)
        {
            <ul>
                <li><b>Předmět:</b> @Model.Offer?.Subject - <b>@String.Format(CultureInfo.CreateSpecificCulture(Model.Offer?.Currency.CultureCode), "{0:C0}", @Model.Offer?.Price)</b> (@String.Format(CultureInfo.CreateSpecificCulture("cs-CZ"), "{0:C0}", Model.Offer?.PriceCzk))</li>
                <li><b>Zákazník:</b> @Model.OfferCompanyName (<b>Splatnost faktury:</b> @Model.InvoiceDueDays dní)</li>
                <li><b>Přijetí poptávky:</b> @String.Format("{0:dd.MM.yyyy}", @Model.Offer.ReceiveDate) / <b>Odeslání nabídky:</b> @String.Format("{0:dd.MM.yyyy}", @Model.Offer.SentDate)</li>
            </ul>
        }

        @* <div class="form-group row">
            <div class="col-lg-5"></div>
            <div class="col-lg-2 align-self-center">
                <button class="btn btn-sm btn-primary" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">
                    <i class="fa fa-angle-down"></i> Detaily
                </button>
            </div>
            <div class="col-lg-5"></div>
        </div> *@

        <div class="collapse" id="collapseExample">

            <div class="form-group row">
                <label asp-for="Offer.ReceiveDate" class="col-lg-3 col-form-label form-control-label control-label"></label>
                <div class="col-lg-4">
                    <input asp-for="Offer.ReceiveDate" class="form-control" type="text" required="" autocomplete="off" readonly />
                </div>
                <label class="col-lg-1 col-form-label form-control-label control-label"> <i class="fa fa-angle-double-right"></i> </label>
                <div class="col-lg-4">
                    <input asp-for="Offer.SentDate" class="form-control" type="text" autocomplete="off" readonly />
                </div>
            </div>

            <div class="form-group row">
                <label asp-for="Offer.Subject" class="col-lg-3 col-form-label form-control-label control-label"></label>
                <div class="col-lg-9">
                    <input asp-for="Offer.Subject" class="form-control" type="text" readonly />
                    <span asp-validation-for="Offer.Subject" class="text-danger"></span>
                </div>
            </div>

            <div class="form-group row">
                <label asp-for="Offer.Price" class="col-lg-3 col-form-label form-control-label control-label"></label>
                <div class="col-lg-5">
                    <input asp-for="Offer.Price" class="form-control" type="text" readonly />
                    <span asp-validation-for="Offer.Price" class="text-danger"></span>
                </div>
                <div class="col-lg-2">
                    @Html.DropDownListFor(model => model.Offer.CurrencyId, ViewBag.CurrencyList as SelectList, new { @class = "form-control", @disabled = "disabled" })
                    @* @Html.HiddenFor(model => model.Offer.CurrencyId) *@
                    <span asp-validation-for="Offer.Currency" class="text-danger"></span>
                </div>
                <div class="col-lg-2">
                    <input asp-for="Offer.ExchangeRate" class="form-control" type="text" readonly />
                    <span asp-validation-for="Offer.ExchangeRate" class="text-danger"></span>
                </div>
            </div>

            <div class="form-group row">
                <label asp-for="InvoiceDueDays" class="col-lg-3 col-form-label form-control-label control-label"></label>
                <div class="col-lg-3">
                    <input asp-for="InvoiceDueDays" class="form-control" type="text" required="" autocomplete="off" readonly />
                </div>
            </div>

        </div>  <!-- END collapse -->

        <div class="cardTitleMerged">
            <div class="">
                <a asp-action="Index" class="btn btn-light border"><i class="fa fa-arrow-left"></i> Zpět</a>
            </div>

            @if (@Model.Offer?.OfferId != 0 && @Model.Offer?.OfferId != null)
            {
                <div class="">
                    <a asp-action="Edit" asp-controller="Offers" asp-route-id="@Model.Offer.OfferId" class="btn btn-primary"><i class="fa fa-list-alt"></i> Přejít na objednávku</a>
                </div>
            }
        </div>

        </form>

        <br />

        <!--------------------------------------------------------------------------------------
            FORM - ZAKAZKA
        --------------------------------------------------------------------------------------->
        <form id="orderForm" class="card" role="form" autocomplete="on" asp-action="Create" method="post" style="visibility: hidden;">
        <div asp-validation-summary="ModelOnly" class="text-danger"></div>
        <input type="hidden" asp-for="OfferId" />
        <input type="hidden" asp-for="Order.OfferId" />

        <h5 class="card-title">Vyplnit novou zakázku</h5>
        <hr />

        <div class="form-group row">
            <label asp-for="Order.OrderName" class="required col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-9">
                <input asp-for="Order.OrderName" class="form-control" type="text" required="" />
                <span asp-validation-for="Order.OrderName" class="text-danger"></span>
            </div>
        </div>

        <div class="form-group eveOrder">
            <div class="form-group row ">
                <label asp-for="Order.OrderCode" class="required col-lg-3 col-form-label form-control-label control-label"></label>
                <div class="col-lg-5">
                    @* <input asp-for="Order.OrderCode" class="form-control" type="text" required="" />
                    <span asp-validation-for="Order.OrderCode" class="text-danger"></span> *@
                    @* <label asp-for="Order.EveOrderCodes" class="col-lg-3 col-form-label form-control-label control-label"></label> *@
                    @Html.DropDownListFor(model => model.Order.OrderCode, ViewBag.EveOrderCodes as SelectList, "-- Vyber kód --", new { @class = "form-control selectpicker" })
                    <span asp-validation-for="Order.OrderCode" class="text-danger"></span>
                    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
                </div>
                <div class="col-lg-2">
                    <a href="@Url.Action("CreateEveProject")" target="_blank" class="btn btn-outline-success form-control"
                    data-toggle="tooltip" data-placement="top" title="Nová EVE zakázka">
                        <i class="fa fa-plus-square"></i>
                    </a>
                </div>
                <div class="col-lg-2">
                    <a href="@Url.Action("CreateEveProjectM")" target="_blank" class="btn btn-outline-success form-control"
                    data-toggle="tooltip" data-placement="top" title="Nová EVE modulová zakázka">
                        <i class="fa fa-plus-square"></i> [M]
                    </a>
                </div>
            </div>
            <div class="form-group row">
                <label asp-for="Order.EveContactName" class="required col-lg-3 col-form-label form-control-label control-label"></label>
                <div class="col-lg-9">
                    @Html.DropDownListFor(model => model.Order.EveContactName, ViewBag.EveContactList as SelectList, "-- Vyber kontakt --", new { @class = "form-control selectpicker" })
                    <span asp-validation-for="Order.EveContactName" class="text-danger"></span>
                </div>
            </div>
        </div>

        <div class="form-group row">
            <label asp-for="Order.BillOfDelivery" class="col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-9">
                @* <div class="custom-file"> *@
                <input asp-for="Order.BillOfDelivery" class="form-control" type="text" />
                <span asp-validation-for="Order.BillOfDelivery" class="text-danger"></span>
            </div>
        </div>

        <div class="form-group row border-top pt-2">
            <div class="col-lg-2 col-form-label d-flex justify-content-left">
                @* <label asp-for="Order.InvoiceIssueDate" class="form-control-label control-label">Faktury</label> *@
                <label class="form-control-label control-label">Faktury</label>
            </div>
            <div class="col-lg-10">
                <a href="#" class="btn btn-success col-lg-3 add-row mt-1" data-toggle="tooltip" title="Přidat fakturaci"><i class="fa fa-plus"></i> Přidat fakturaci</a>
            </div>
        </div>

        @Html.ValidationMessage("InvoiceMissing", "", new { @class = "text-danger" })
        <div class="dynamic-rows" id="template" data-order="@Model.Order.Invoices.Count()">
            @for (int i = 0; i < Model.Order.Invoices.Count(); i++)
            {
                <div class="row form-group justify-content-end">
                    <input hidden="true" asp-for="@Model.Order.Invoices[i].InvoiceId" />
                    <div class="col-lg-3 mycalendar">
                        <input asp-for="@Model.Order.Invoices[i].InvoiceIssueDate" class="form-control" type="text" autocomplete="off" placeholder="Termín vystavení" />
                        <span asp-validation-for="@Model.Order.Invoices[i].InvoiceIssueDate" class="text-danger"></span>
                    </div>
                    <div class="col-lg-3 mycalendar">
                        <input asp-for="@Model.Order.Invoices[i].InvoiceDueDate" class="form-control" type="text" autocomplete="off" placeholder="Splatnost faktury" />
                        <span asp-validation-for="@Model.Order.Invoices[i].InvoiceDueDate" class="text-danger"></span>
                    </div>
                    <div class="col-lg-3">
                        <div class="input-group mb-2 mr-sm-2">
                            <div class="input-group-prepend">
                                <div class="input-group-text">@Model.CurrencyName</div>
                            </div>
                            <input asp-for="@Model.Order.Invoices[i].Cost" class="form-control" type="text" placeholder="Částka" />
                            <span asp-validation-for="@Model.Order.Invoices[i].Cost" class="text-danger"></span>
                        </div>
                    </div>
                    <div class="col-lg-1">
                        <a href="#" class="btn btn-danger btn-sm mt-1" data-toggle="tooltip" title="Odstranit záznam" onclick="DeleteInvoice(@Model.Order.Invoices[i].InvoiceId)"><i class="fa fa-trash"></i></a>
                    </div>
                </div>
            }
            <span asp-validation-for="Order.Invoices" class="text-danger"></span>
        </div>

        @* <div class="form-group row">
            <label asp-for="Order.InvoiceIssueDate" class="required col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-9 mycalendar">
                <input asp-for="Order.InvoiceIssueDate" class="form-control" type="text" autocomplete="off"/>
                <span asp-validation-for="Order.InvoiceIssueDate" class="text-danger"></span>
            </div>
        </div> *@
        @* TODO: pridat zde navaznost na Offer.Company.InvoiceDueDays a pri onchange() InvoiceIssueDate pridat dny, pokud prazdne*@
        @* <div class="form-group row">
            <label asp-for="Order.InvoiceDueDate" class="col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-9 mycalendar">
                <input asp-for="Order.InvoiceDueDate" class="form-control" type="text" autocomplete="off"/>
                <span asp-validation-for="Order.InvoiceDueDate" class="text-danger"></span>
            </div>
        </div> *@

        <div class="form-group row">
            <label asp-for="Order.PriceFinal" class="required col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-3">
                <div class="input-group mb-2 mr-sm-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text">@Model.CurrencyName</div>
                    </div>
                    <input asp-for="Order.PriceFinal" class="form-control" type="text" required="" />
                </div>
                <span asp-validation-for="Order.PriceFinal" class="text-danger"></span>
            </div>
            <div class="col-lg-3">
                <label asp-for="Order.PriceDiscount" class="col-form-label form-control-label control-label"></label>
            </div>
            <div class="col-lg-3">
                <div class="input-group mb-2 mr-sm-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text">@Model.CurrencyName</div>
                    </div>
                    <input asp-for="Order.PriceDiscount" class="form-control" type="text" required="" readonly />
                </div>
                <span asp-validation-for="Order.PriceDiscount" class="text-danger"></span>
            </div>
        </div>

        <div class="form-group row">
            <label asp-for="Order.OtherCosts" class="col-lg-3 col-form-label form-control-label control-label" ></label>
            <div class="col-lg-3">
                <div class="input-group mb-2 mr-sm-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text">@Model.CurrencyName</div>
                    </div>
                    <input asp-for="Order.OtherCosts" class="form-control" type="text" />
                </div>
                <span asp-validation-for="Order.OtherCosts" class="text-danger"></span>
            </div>
            <label asp-for="Order.HourWage" class="required col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-3">
                 <div class="input-group mb-2 mr-sm-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text">@Model.CurrencyName</div>
                    </div>
                    <input asp-for="Order.HourWage" class="form-control" type="text" onchange="this.value = this.value.replace(/,/g, '.')"/>
                 </div>
                <span asp-validation-for="Order.HourWage" class="text-danger"></span>
            </div>
        </div>

        <div class="form-group row">
            <label asp-for="Order.PriceFinalCzk" class="col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-3">
                <div class="input-group mb-2 mr-sm-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text">Kč</div>
                    </div>
                    <input asp-for="Order.PriceFinalCzk" class="form-control" type="text" readonly />
                </div>
                <span asp-validation-for="Order.PriceFinalCzk" class="text-danger"></span>
            </div>
            <label asp-for="Order.ExchangeRate" class="col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-3">
                 <div class="input-group mb-2 mr-sm-2">
                    <div class="input-group-prepend">
                        <div class="input-group-text"><span>@Model.CurrencyName</span></div>
                    </div>
                    <input asp-for="Order.ExchangeRate" class="form-control" type="text" />
                    <div class="input-group-append">
                        <div class="input-group-text" data-toggle="tooltip" title="Vložit dnešní kurz z ČNB" onclick="changeExchangeRate('@Model.CurrencyName');" style="cursor: pointer;">
                            <i class="fa fa-caret-left">&nbsp;<i class="fa fa-cloud-download"></i></i>
                        </div>
                    </div>
                 </div>
                <span asp-validation-for="Order.ExchangeRate" class="text-danger"></span>
            </div>
        </div>

        <div class="form-group row">
            <label asp-for="Order.Notes" class="col-lg-3 col-form-label form-control-label control-label"></label>
            <div class="col-lg-9">
                <textarea asp-for="Order.Notes" class="form-control"></textarea>
                @* @Html.TextAreaFor(m => m.Order.Notes, additionalViewData: new { htmlAttributes = new { @class = "form-control" }}) *@
                <span asp-validation-for="Order.Notes" class="text-danger"></span>
            </div>
        </div>

        <div class="form-group row">
            <div class="col-lg-3">
                <a asp-action="Index" class="btn btn-light border"><i class="fa fa-arrow-left"></i> Zpět</a>
            </div>
            <div class="col-lg-9">
                <input type="reset" class="btn btn-secondary" value="Vyprázdnit pole" data-toggle="tooltip" title="Vyprázdní všechna pole" />
                <input type="submit" class="btn btn-primary" value="Vytvořit zakázku" />
            </div>
        </div>

        @Html.CheckBoxFor(m => m.Order.Active, new { style = "display:none", @checked="checked" })

        </form>
    </div>
</div>


@section Scripts {

    @{await Html.RenderPartialAsync("_ValidationScriptsPartial");}

    <script>

        function DeleteInvoice(invoiceId) {
            console.log(`Deleting invoice id: ${invoiceId}`);
            var row = document.getElementById(`dynamic-row-${invoiceId}`);
            //row.querySelectorAll('*').forEach(n => n.remove());
            row.remove();

            //$.ajax({
            //    //async: true,
            //    type: 'POST',
            //    dataType: 'JSON',
            //    ContentType: 'application/json; charset=utf-8',
            //    url: '@Url.Action("DeleteInvoice")',
            //    data: { id: invoiceId },
            //    cache: false,
            //    beforeSend:function(){
            //        return confirm(
            //            "Jste si jisti??? Tento úkon smaže označenou fakturaci!"
            //        );
            //    },
            //    success: function(data) {
            //        window.location = "@Model.Order.OrderId";  // return Orders/Edit/{OrderId}
            //    },
            //    error: function(data) {
            //         //alert(JSON.stringify(data.responseJSON.errorMessage));
            //         alert(data.responseJSON.errorMessage);
            //    }
            //});
        }

        function changeExchangeRate(curSymbol) {
            $.ajax({
                url: '@Url.Action("getCurrencyStr", "Orders")',
                type: 'GET',
                //dataType: 'json',
                // we set cache: false because GET requests are often cached by browsers
                // IE is particularly aggressive in that respect
                cache: false,
                data: { symbol: curSymbol },
                success: function(res) {
                    //$('#Order_ExchangeRate').val(res).focus().keyup().blur();
                    $('#Order_ExchangeRate').val(res).keyup();
                }
            });
        }

        $(document).ready(function(){

            var datepickerParameters = new Array({
                format: "yyyy-mm-dd",
                startDate: "1980-01-01",
                endDate: "2021-01-01",
                todayBtn: "linked",
                language: "cs",
                daysOfWeekHighlighted: "0,6",
                calendarWeeks: true,
                autoclose: true,
                todayHighlight: true
            });

            //var offerId = document.getElementById("#Order_OfferId").value;
            if (@Model.Order.OfferId != 0) {
                console.log("OfferId: " + @Model.Order.OfferId);
                document.getElementById("orderForm").style.visibility = "visible";
            }

            //$('#Order_BillOfDelivery').on('change',
            //    function() {
            //        //get the file name
            //        var fileName = $(this).val();
            //        //replace the "Choose a file" label
            //        $(this).next('.custom-file-label').html(fileName);
            //    })

            $('.mycalendar input').datepicker(datepickerParameters[0]);
            //    // format: "dd.mm.yyyy",
            //    // startDate: "01.01.1980",
            //    // endDate: "01.01.2021",
            //    format: "yyyy-mm-dd",
            //    startDate: "1980-01-01",
            //    endDate: "2021-01-01",
            //    todayBtn: "linked",
            //    language: "cs",
            //    daysOfWeekHighlighted: "0,6",
            //    calendarWeeks: true,
            //    autoclose: true,
            //    todayHighlight: true
            //});


            $('#Order_PriceFinal').on('input', function(){
                var offerPrice = parseInt($('#Offer_Price').val());
                var finalPrice = parseInt($('#Order_PriceFinal').val());
                $('#Order_PriceDiscount').val(offerPrice - finalPrice);
            });


            $('#Order_InvoiceIssueDate').change('input', function(){
                var date = new Date($('#Order_InvoiceIssueDate').val());
                date.setDate( date.getUTCDate() + @Model.InvoiceDueDays );
                var futureDate = date.getFullYear()
                    +'-'
                    +('0'+(date.getMonth()+1)).slice(-2)
                    +'-'
                    +('0'+(date.getDate())).slice(-2);
                $('#Order_InvoiceDueDate').val(futureDate);
            });

            // PriceFinalCzk realtime refresh
            var exchangeRate = document.getElementById('Order_ExchangeRate')
            var priceFinal = document.getElementById('Order_PriceFinal')
            var otherCosts = document.getElementById('Order_OtherCosts')
            var priceFinalCzk = document.getElementById('Order_PriceFinalCzk')

            trigFunc = function(){
                var exchangeRateNum = parseFloat(exchangeRate.value.replace(/,/g, "."))
                var priceFinalNum = parseFloat(priceFinal.value.replace(/,/g, "."))
                var otherCostsNum = parseFloat(otherCosts.value.replace(/,/g, "."))
                priceFinalCzk.value = parseInt(exchangeRateNum * (priceFinalNum - otherCostsNum));
            }
            exchangeRate.onkeyup = trigFunc;
            priceFinal.onkeyup = trigFunc;
            otherCosts.onkeyup = trigFunc;

            // Add new INVOICES row
            var i = @Model.Order.Invoices.Count();
            $('.add-row').click(function () {
                var idNum = i + 1;
                var html =
                    '<div class="row form-group justify-content-end" id="dynamic-row-' + i + '">'+
                        '<input type="number" hidden="true" data-val="true" data-val-required="The InvoiceId field is required." id="Order_Invoices_' + i + '__InvoiceId" name="Order.Invoices[' + i + '].InvoiceId" value="0">'+
                        //'<input type="number" hidden="true" data-val="true" data-val-required="The OfferId field is required." id="Order_Invoices_' + i + '__OrderId" name="Order.Invoices[' + i + '].OrderId" value="' + idNum + '">'+
                        '<div class="col-lg-3 mycalendar">'+
                            '<input class="form-control" type="text" autocomplete="off" placeholder="Termín vystavení" data-val="true" data-val-required="The Předp. termín vystavení faktury field is required." id="Order_Invoices_' + i + '__InvoiceIssueDate" name="Order.Invoices[' + i + '].InvoiceIssueDate" value="">'+
                            '<span class="text-danger field-validation-valid" data-valmsg-for="Order.Invoices[' + i + '].InvoiceIssueDate" data-valmsg-replace="true"></span>'+
                        '</div>'+
                        '<div class="col-lg-3 mycalendar">'+
                            '<input class="form-control" type="text" autocomplete="off" placeholder="Splatnost faktury" data-val="true" data-val-required="The Splatnost faktury field is required." id="Order_Invoices_' + i + '__InvoiceDueDate" name="Order.Invoices[' + i + '].InvoiceDueDate" value="">'+
                            '<span class="text-danger field-validation-valid" data-valmsg-for="Order.Invoices[' + i + '].InvoiceDueDate" data-valmsg-replace="true"></span>'+
                        '</div>'+
                        '<div class="col-lg-3">'+
                            '<div class="input-group mb-2 mr-sm-2">'+
                                '<div class="input-group-prepend">'+
                                    '<div class="input-group-text">@Model.CurrencyName</div>'+
                                '</div>'+
                                '<input class="form-control" type="text" placeholder="Částka" data-val="true" data-val-number="The field Částka must be a number." data-val-required="The Částka field is required." id="Order_Invoices_' + i + '__Cost" name="Order.Invoices[' + i + '].Cost" value="">'+
                                '<span class="text-danger field-validation-valid" data-valmsg-for="Order.Invoices[' + i + '].Cost" data-valmsg-replace="true"></span>'+
                            '</div>'+
                        '</div>'+
                        '<div class="col-lg-1">'+
                            '<a href="#" class="btn btn-danger btn-sm mt-1" data-toggle="tooltip" title="" data-original-title="Odstranit záznam" onclick="DeleteInvoice(' + i + ')"><i class="fa fa-trash white"></i></a>'+
                        '</div>'+
                    '</div>';
                //$("tbody").append($(html).clone(true))
                var _formTemp = $("#template").clone(true)
                var _targetForm = $(".dynamic-rows")
                _targetForm.append(html)

                $('#Order_Invoices_' + i + '__InvoiceIssueDate').datepicker(datepickerParameters[0]);
                $('#Order_Invoices_' + i + '__InvoiceDueDate').datepicker(datepickerParameters[0]);

                $('form').data('validator', null);
                $.validator.unobtrusive.parse($('form'));

                //AddInvoice(i)

                i = i + 1;
                return false;
            });

        })

    </script>

}

